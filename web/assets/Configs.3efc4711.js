import{s as e,r as a}from"./index.d0a782d5.js";import{A as l,B as t,L as n,C as o,r as d,o as r,c as s,g as u,l as c,h as i,t as p,F as m,m as g}from"./vendor.971a53c8.js";const f=a=>e({url:"/log/newLog",method:"post",data:a});const b={name:"config",setup(){const d=a.currentRoute.value.query.id,r=a.currentRoute.value.query.namespace,s=l("data"),u=t({namespace_id:Number(d)}),c=l([]),i=()=>{var a;(a=u,e({url:"/config/getAllConfigs",method:"post",data:a})).then((e=>{c.value=e.data}))},p=t({namespace_id:Number(d),pageIndex:1,pageSize:10}),m=l([]),g=l(0),b=()=>{var a;(a=p,e({url:"/log/getAllLogs",method:"post",data:a})).then((e=>{m.value=e.data.log,g.value=e.data.count||50}))};i(),b();const y=l(!1);let k=t({key:"",value:""});return{namespace:r,namespaceID:d,message:s,dQuery:u,dTableData:c,lQuery:p,lTableData:m,lPageTotal:g,dHandleDelete:(e,a)=>{n.confirm("确定要删除吗？","提示",{type:"warning"}).then((()=>{f({namespace_id:Number(e),key:a.key.substring(r.length+1),value:a.value,type:1}).then((e=>{0===e.status?(o.success("添加成功"),b()):o.error("添加失败")}))})).catch((()=>{}))},dHandleAdd:()=>{k.key="",k.value="",y.value=!0},dHandlePageChange:e=>{u.pageIndex=e,i()},lHandlePageChange:e=>{p.pageIndex=e,b()},lHandleDelete:a=>{n.confirm("确定要删除吗？","提示",{type:"warning"}).then((()=>{var l;(l={id:a},e({url:"/log/delLog",method:"post",data:l})).then((e=>{0===e.status?(o.success("删除成功"),b()):o.error("删除失败")}))})).catch((()=>{}))},lHandleCommit:a=>{n.confirm("确定要提交吗？","提示",{type:"warning"}).then((()=>{var l;(l={id:a,namespace_id:Number(d)},e({url:"/log/commit",method:"post",data:l})).then((e=>{0===e.status?(o.success("提交成功"),b(),i()):o.error("提交失败")}))})).catch((()=>{}))},addConfig:()=>{n.confirm("确定要添加吗？","提示",{type:"warning"}).then((()=>{f({namespace_id:Number(d),key:k.key,value:k.value,type:0}).then((e=>{0===e.status?(o.success("添加成功"),y.value=!1,b()):o.error("添加失败")}))})).catch((()=>{}))},addVisible:y,form:k}}},y={class:""},k={class:"crumbs"},h=u("i",{class:"el-icon-lx-copy"},null,-1),v={class:"container"},_={class:"handle-box"},C=i("新增"),w=i("删除"),V={key:0},x={key:1},H={key:0},D={key:1},T=i("提交"),I=i("回滚"),A=i("删除"),N={class:"pagination"},P={class:"dialog-footer"},U=i("取 消"),z=i("确 定");b.render=function(e,a,l,t,n,o){const f=d("el-breadcrumb-item"),b=d("el-breadcrumb"),L=d("el-button"),Q=d("el-table-column"),S=d("el-table"),j=d("el-tab-pane"),q=d("el-tag"),R=d("el-pagination"),B=d("el-tabs"),F=d("el-input"),E=d("el-form-item"),G=d("el-form"),J=d("el-dialog");return r(),s("div",y,[u("div",k,[u(b,{separator:"/"},{default:c((()=>[u(f,null,{default:c((()=>[h,i(" 命名空间: "+p(t.namespace),1)])),_:1})])),_:1})]),u("div",v,[u(B,{modelValue:t.message,"onUpdate:modelValue":a[1]||(a[1]=e=>t.message=e)},{default:c((()=>[u(j,{label:"数据",name:"data"},{default:c((()=>[u("div",_,[u(L,{type:"primary",icon:"el-icon-plus",onClick:t.dHandleAdd},{default:c((()=>[C])),_:1},8,["onClick"])]),u(S,{data:t.dTableData,border:"",class:"table",ref:"multipleTable","header-cell-class-name":"table-header"},{default:c((()=>[u(Q,{prop:"key",label:"key"}),u(Q,{prop:"value",label:"value"}),u(Q,{label:"操作",align:"center"},{default:c((e=>[u(L,{type:"text",icon:"el-icon-delete",class:"red",onClick:a=>t.dHandleDelete(t.namespaceID,e.row)},{default:c((()=>[w])),_:2},1032,["onClick"])])),_:1})])),_:1},8,["data"])])),_:1}),u(j,{label:"操作记录",name:"operation"},{default:c((()=>["operation"===t.message?(r(),s(m,{key:0},[u(S,{data:t.lTableData,border:"",class:"table",ref:"multipleTable","header-cell-class-name":"table-header"},{default:c((()=>[u(Q,{prop:"id",label:"id"}),u(Q,{label:"操作类型",align:"center"},{default:c((e=>[u(q,{effect:"dark",type:0===e.row.type?"success":"danger"},{default:c((()=>[0===e.row.type?(r(),s("p",V," Set ")):(r(),s("p",x," Del "))])),_:2},1032,["type"])])),_:1}),u(Q,{prop:"key",label:"key"}),u(Q,{prop:"value",label:"value"}),u(Q,{prop:"username",label:"用户"}),u(Q,{label:"状态",align:"center"},{default:c((e=>[u(q,{effect:"dark",type:1===e.row.status?"success":"danger"},{default:c((()=>[1===e.row.status?(r(),s("p",H," Committed ")):(r(),s("p",D," Uncommitted "))])),_:2},1032,["type"])])),_:1}),u(Q,{label:"操作",align:"center"},{default:c((e=>[0===e.row.status?(r(),s(L,{key:0,type:"text",icon:"el-icon-s-promotion",onClick:a=>t.lHandleCommit(e.row.id)},{default:c((()=>[T])),_:2},1032,["onClick"])):g("",!0),1===e.row.status?(r(),s(L,{key:1,type:"text",icon:"el-icon-s-promotion",class:"green",onClick:a=>t.lHandleCommit(e.row.id)},{default:c((()=>[I])),_:2},1032,["onClick"])):g("",!0),u(L,{type:"text",icon:"el-icon-delete",class:"red",onClick:a=>t.lHandleDelete(e.row.id)},{default:c((()=>[A])),_:2},1032,["onClick"])])),_:1})])),_:1},8,["data"]),u("div",N,[u(R,{background:"",layout:"total, prev, pager, next","current-page":t.lQuery.pageIndex,"page-size":t.lQuery.pageSize,total:t.lPageTotal,onCurrentChange:t.lHandlePageChange},null,8,["current-page","page-size","total","onCurrentChange"])])],64)):g("",!0)])),_:1})])),_:1},8,["modelValue"])]),u(J,{title:"新增",modelValue:t.addVisible,"onUpdate:modelValue":a[5]||(a[5]=e=>t.addVisible=e),width:"30%"},{footer:c((()=>[u("span",P,[u(L,{onClick:a[4]||(a[4]=e=>t.addVisible=!1)},{default:c((()=>[U])),_:1}),u(L,{type:"primary",onClick:t.addConfig},{default:c((()=>[z])),_:1},8,["onClick"])])])),default:c((()=>[u(G,{"label-width":"70px"},{default:c((()=>[u(E,{label:"key"},{default:c((()=>[u(F,{modelValue:t.form.key,"onUpdate:modelValue":a[2]||(a[2]=e=>t.form.key=e)},null,8,["modelValue"])])),_:1}),u(E,{label:"value"},{default:c((()=>[u(F,{modelValue:t.form.value,"onUpdate:modelValue":a[3]||(a[3]=e=>t.form.value=e)},null,8,["modelValue"])])),_:1})])),_:1})])),_:1},8,["modelValue"])])};export default b;
