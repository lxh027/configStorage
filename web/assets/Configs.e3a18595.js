import{s as e}from"./request.a57216d8.js";import{B as a,C as l,r as t,o,e as d,f as n,g as r,w as s,i as u,t as c,F as i,h as p,L as m,D as g}from"./vendor.da3fc754.js";import{_ as f,r as b}from"./index.939ea1aa.js";const y=a=>e({url:"/log/newLog",method:"post",data:a});const h={name:"config",setup(){const t=b.currentRoute.value.query.id,o=b.currentRoute.value.query.namespace,d=a("data"),n=l({namespace_id:Number(t)}),r=a([]),s=()=>{var a;(a=n,e({url:"/config/getAllConfigs",method:"post",data:a})).then((e=>{r.value=e.data}))},u=l({namespace_id:Number(t),pageIndex:1,pageSize:10}),c=a([]),i=a(0),p=()=>{var a;(a=u,e({url:"/log/getAllLogs",method:"post",data:a})).then((e=>{c.value=e.data.log,i.value=e.data.count||50}))};s(),p();const f=a(!1);let h=l({key:"",value:""});return{namespace:o,namespaceID:t,message:d,dQuery:n,dTableData:r,lQuery:u,lTableData:c,lPageTotal:i,dHandleDelete:(e,a)=>{m.confirm("确定要删除吗？","提示",{type:"warning"}).then((()=>{y({namespace_id:Number(e),key:a.key,value:a.value,type:1}).then((e=>{0===e.status?g.success("添加成功"):g.error("添加失败")})),p()})).catch((()=>{}))},dHandleAdd:()=>{h.key="",h.value="",f.value=!0},dHandlePageChange:e=>{n.pageIndex=e,s()},lHandlePageChange:e=>{u.pageIndex=e,p()},lHandleDelete:a=>{m.confirm("确定要删除吗？","提示",{type:"warning"}).then((()=>{var l;(l={id:a},e({url:"/log/delLog",method:"post",data:l})).then((e=>{0===e.status?g.success("删除成功"):g.error("删除失败")})),p()})).catch((()=>{}))},lHandleCommit:a=>{m.confirm("确定要提交吗？","提示",{type:"warning"}).then((()=>{var l;(l={id:a,namespace_id:Number(t)},e({url:"/log/commit",method:"post",data:l})).then((e=>{0===e.status?g.success("提交成功"):g.error("提交失败")})),p()})).catch((()=>{}))},addConfig:()=>{m.confirm("确定要添加吗？","提示",{type:"warning"}).then((()=>{console.log(t),console.log(Number(t)),y({namespace_id:Number(t),key:h.key,value:h.value,type:0}).then((e=>{0===e.status?(g.success("添加成功"),f.value=!1):g.error("添加失败")})),p()})).catch((()=>{}))},addVisible:f,form:h}}},k={class:""},v={class:"crumbs"},_=n("i",{class:"el-icon-lx-copy"},null,-1),C={class:"container"},V={class:"handle-box"},w=u("新增"),x=u("删除"),D={key:0},H={key:1},T={key:0},I={key:1},N=u("提交"),P=u("删除"),U={class:"pagination"},z={class:"dialog-footer"},A=u("取 消"),L=u("确 定");var Q=f(h,[["render",function(e,a,l,m,g,f){const b=t("el-breadcrumb-item"),y=t("el-breadcrumb"),h=t("el-button"),Q=t("el-table-column"),j=t("el-table"),q=t("el-tab-pane"),S=t("el-tag"),R=t("el-pagination"),B=t("el-tabs"),F=t("el-input"),E=t("el-form-item"),G=t("el-form"),J=t("el-dialog");return o(),d("div",k,[n("div",v,[r(y,{separator:"/"},{default:s((()=>[r(b,null,{default:s((()=>[_,u(" 命名空间: "+c(m.namespace),1)])),_:1})])),_:1})]),n("div",C,[r(B,{modelValue:m.message,"onUpdate:modelValue":a[0]||(a[0]=e=>m.message=e)},{default:s((()=>[r(q,{label:"数据",name:"data"},{default:s((()=>[n("div",V,[r(h,{type:"primary",icon:"el-icon-plus",onClick:m.dHandleAdd},{default:s((()=>[w])),_:1},8,["onClick"])]),r(j,{data:m.dTableData,border:"",class:"table",ref:"multipleTable","header-cell-class-name":"table-header"},{default:s((()=>[r(Q,{prop:"key",label:"key"}),r(Q,{prop:"value",label:"value"}),r(Q,{label:"操作",align:"center"},{default:s((e=>[r(h,{type:"text",icon:"el-icon-delete",class:"red",onClick:a=>m.dHandleDelete(m.namespaceID,e.row)},{default:s((()=>[x])),_:2},1032,["onClick"])])),_:1})])),_:1},8,["data"])])),_:1}),r(q,{label:"操作记录",name:"operation"},{default:s((()=>["operation"===m.message?(o(),d(i,{key:0},[r(j,{data:m.lTableData,border:"",class:"table",ref:"multipleTable","header-cell-class-name":"table-header"},{default:s((()=>[r(Q,{prop:"id",label:"id"}),r(Q,{label:"操作类型",align:"center"},{default:s((e=>[r(S,{effect:"dark",type:0===e.row.type?"success":"danger"},{default:s((()=>[0===e.row.type?(o(),d("p",D," Set ")):(o(),d("p",H," Del "))])),_:2},1032,["type"])])),_:1}),r(Q,{prop:"key",label:"key"}),r(Q,{prop:"value",label:"value"}),r(Q,{prop:"username",label:"用户"}),r(Q,{label:"状态",align:"center"},{default:s((e=>[r(S,{effect:"dark",type:1===e.row.status?"success":"danger"},{default:s((()=>[1===e.row.status?(o(),d("p",T," Committed ")):(o(),d("p",I," Uncommitted "))])),_:2},1032,["type"])])),_:1}),r(Q,{label:"操作",align:"center"},{default:s((e=>[r(h,{type:"text",icon:"el-icon-s-promotion",onClick:a=>m.lHandleCommit(e.row.id)},{default:s((()=>[N])),_:2},1032,["onClick"]),r(h,{type:"text",icon:"el-icon-delete",class:"red",onClick:a=>m.lHandleDelete(e.row.id)},{default:s((()=>[P])),_:2},1032,["onClick"])])),_:1})])),_:1},8,["data"]),n("div",U,[r(R,{background:"",layout:"total, prev, pager, next","current-page":m.lQuery.pageIndex,"page-size":m.lQuery.pageSize,total:m.lPageTotal,onCurrentChange:m.lHandlePageChange},null,8,["current-page","page-size","total","onCurrentChange"])])],64)):p("",!0)])),_:1})])),_:1},8,["modelValue"])]),r(J,{title:"新增",modelValue:m.addVisible,"onUpdate:modelValue":a[4]||(a[4]=e=>m.addVisible=e),width:"30%"},{footer:s((()=>[n("span",z,[r(h,{onClick:a[3]||(a[3]=e=>m.addVisible=!1)},{default:s((()=>[A])),_:1}),r(h,{type:"primary",onClick:m.addConfig},{default:s((()=>[L])),_:1},8,["onClick"])])])),default:s((()=>[r(G,{"label-width":"70px"},{default:s((()=>[r(E,{label:"key"},{default:s((()=>[r(F,{modelValue:m.form.key,"onUpdate:modelValue":a[1]||(a[1]=e=>m.form.key=e)},null,8,["modelValue"])])),_:1}),r(E,{label:"value"},{default:s((()=>[r(F,{modelValue:m.form.value,"onUpdate:modelValue":a[2]||(a[2]=e=>m.form.value=e)},null,8,["modelValue"])])),_:1})])),_:1})])),_:1},8,["modelValue"])])}]]);export{Q as default};
