import{s as e}from"./request.a57216d8.js";import{B as a,C as l,r as t,o,e as n,f as d,g as r,w as s,i as u,t as c,F as i,c as p,h as m,L as g,D as f}from"./vendor.da3fc754.js";import{_ as b,r as y}from"./index.0cb5857a.js";const k=a=>e({url:"/log/newLog",method:"post",data:a});const h={name:"config",setup(){const t=y.currentRoute.value.query.id,o=y.currentRoute.value.query.namespace,n=a("data"),d=l({namespace_id:Number(t)}),r=a([]),s=()=>{var a;(a=d,e({url:"/config/getAllConfigs",method:"post",data:a})).then((e=>{r.value=e.data}))},u=l({namespace_id:Number(t),pageIndex:1,pageSize:10}),c=a([]),i=a(0),p=()=>{var a;(a=u,e({url:"/log/getAllLogs",method:"post",data:a})).then((e=>{c.value=e.data.log,i.value=e.data.count||50}))};s(),p();const m=a(!1);let b=l({key:"",value:""});return{namespace:o,namespaceID:t,message:n,dQuery:d,dTableData:r,lQuery:u,lTableData:c,lPageTotal:i,dHandleDelete:(e,a)=>{g.confirm("确定要删除吗？","提示",{type:"warning"}).then((()=>{k({namespace_id:Number(e),key:a.key.substring(o.length+1),value:a.value,type:1}).then((e=>{0===e.status?(f.success("添加成功"),p()):f.error("添加失败")}))})).catch((()=>{}))},dHandleAdd:()=>{b.key="",b.value="",m.value=!0},dHandlePageChange:e=>{d.pageIndex=e,s()},lHandlePageChange:e=>{u.pageIndex=e,p()},lHandleDelete:a=>{g.confirm("确定要删除吗？","提示",{type:"warning"}).then((()=>{var l;(l={id:a},e({url:"/log/delLog",method:"post",data:l})).then((e=>{0===e.status?(f.success("删除成功"),p()):f.error("删除失败")}))})).catch((()=>{}))},lHandleCommit:a=>{g.confirm("确定要提交吗？","提示",{type:"warning"}).then((()=>{var l;(l={id:a,namespace_id:Number(t)},e({url:"/log/commit",method:"post",data:l})).then((e=>{0===e.status?(f.success("提交成功"),p(),s()):f.error("提交失败")}))})).catch((()=>{}))},addConfig:()=>{g.confirm("确定要添加吗？","提示",{type:"warning"}).then((()=>{console.log(t),console.log(Number(t)),k({namespace_id:Number(t),key:b.key,value:b.value,type:0}).then((e=>{0===e.status?(f.success("添加成功"),m.value=!1,p()):f.error("添加失败")}))})).catch((()=>{}))},addVisible:m,form:b}}},v={class:""},_={class:"crumbs"},C=d("i",{class:"el-icon-lx-copy"},null,-1),w={class:"container"},V={class:"handle-box"},x=u("新增"),D=u("删除"),H={key:0},T={key:1},I={key:0},N={key:1},P=u("提交"),U=u("回滚"),z=u("删除"),A={class:"pagination"},L={class:"dialog-footer"},Q=u("取 消"),j=u("确 定");var q=b(h,[["render",function(e,a,l,g,f,b){const y=t("el-breadcrumb-item"),k=t("el-breadcrumb"),h=t("el-button"),q=t("el-table-column"),S=t("el-table"),R=t("el-tab-pane"),B=t("el-tag"),F=t("el-pagination"),E=t("el-tabs"),G=t("el-input"),J=t("el-form-item"),K=t("el-form"),M=t("el-dialog");return o(),n("div",v,[d("div",_,[r(k,{separator:"/"},{default:s((()=>[r(y,null,{default:s((()=>[C,u(" 命名空间: "+c(g.namespace),1)])),_:1})])),_:1})]),d("div",w,[r(E,{modelValue:g.message,"onUpdate:modelValue":a[0]||(a[0]=e=>g.message=e)},{default:s((()=>[r(R,{label:"数据",name:"data"},{default:s((()=>[d("div",V,[r(h,{type:"primary",icon:"el-icon-plus",onClick:g.dHandleAdd},{default:s((()=>[x])),_:1},8,["onClick"])]),r(S,{data:g.dTableData,border:"",class:"table",ref:"multipleTable","header-cell-class-name":"table-header"},{default:s((()=>[r(q,{prop:"key",label:"key"}),r(q,{prop:"value",label:"value"}),r(q,{label:"操作",align:"center"},{default:s((e=>[r(h,{type:"text",icon:"el-icon-delete",class:"red",onClick:a=>g.dHandleDelete(g.namespaceID,e.row)},{default:s((()=>[D])),_:2},1032,["onClick"])])),_:1})])),_:1},8,["data"])])),_:1}),r(R,{label:"操作记录",name:"operation"},{default:s((()=>["operation"===g.message?(o(),n(i,{key:0},[r(S,{data:g.lTableData,border:"",class:"table",ref:"multipleTable","header-cell-class-name":"table-header"},{default:s((()=>[r(q,{prop:"id",label:"id"}),r(q,{label:"操作类型",align:"center"},{default:s((e=>[r(B,{effect:"dark",type:0===e.row.type?"success":"danger"},{default:s((()=>[0===e.row.type?(o(),n("p",H," Set ")):(o(),n("p",T," Del "))])),_:2},1032,["type"])])),_:1}),r(q,{prop:"key",label:"key"}),r(q,{prop:"value",label:"value"}),r(q,{prop:"username",label:"用户"}),r(q,{label:"状态",align:"center"},{default:s((e=>[r(B,{effect:"dark",type:1===e.row.status?"success":"danger"},{default:s((()=>[1===e.row.status?(o(),n("p",I," Committed ")):(o(),n("p",N," Uncommitted "))])),_:2},1032,["type"])])),_:1}),r(q,{label:"操作",align:"center"},{default:s((e=>[0===e.row.status?(o(),p(h,{key:0,type:"text",icon:"el-icon-s-promotion",onClick:a=>g.lHandleCommit(e.row.id)},{default:s((()=>[P])),_:2},1032,["onClick"])):m("",!0),1===e.row.status?(o(),p(h,{key:1,type:"text",icon:"el-icon-s-promotion",class:"green",onClick:a=>g.lHandleCommit(e.row.id)},{default:s((()=>[U])),_:2},1032,["onClick"])):m("",!0),r(h,{type:"text",icon:"el-icon-delete",class:"red",onClick:a=>g.lHandleDelete(e.row.id)},{default:s((()=>[z])),_:2},1032,["onClick"])])),_:1})])),_:1},8,["data"]),d("div",A,[r(F,{background:"",layout:"total, prev, pager, next","current-page":g.lQuery.pageIndex,"page-size":g.lQuery.pageSize,total:g.lPageTotal,onCurrentChange:g.lHandlePageChange},null,8,["current-page","page-size","total","onCurrentChange"])])],64)):m("",!0)])),_:1})])),_:1},8,["modelValue"])]),r(M,{title:"新增",modelValue:g.addVisible,"onUpdate:modelValue":a[4]||(a[4]=e=>g.addVisible=e),width:"30%"},{footer:s((()=>[d("span",L,[r(h,{onClick:a[3]||(a[3]=e=>g.addVisible=!1)},{default:s((()=>[Q])),_:1}),r(h,{type:"primary",onClick:g.addConfig},{default:s((()=>[j])),_:1},8,["onClick"])])])),default:s((()=>[r(K,{"label-width":"70px"},{default:s((()=>[r(J,{label:"key"},{default:s((()=>[r(G,{modelValue:g.form.key,"onUpdate:modelValue":a[1]||(a[1]=e=>g.form.key=e)},null,8,["modelValue"])])),_:1}),r(J,{label:"value"},{default:s((()=>[r(G,{modelValue:g.form.value,"onUpdate:modelValue":a[2]||(a[2]=e=>g.form.value=e)},null,8,["modelValue"])])),_:1})])),_:1})])),_:1},8,["modelValue"])])}]]);export{q as default};
