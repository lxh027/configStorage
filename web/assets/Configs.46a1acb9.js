import{s as e}from"./request.111ca7cf.js";import{z as a,A as l,L as t,B as o,r as n,o as d,c as r,f as s,l as u,h as c,t as i,F as p,g as m}from"./vendor.72ef4fca.js";import{r as g}from"./index.61e35ad4.js";const f=a=>e({url:"/log/newLog",method:"post",data:a});const b={name:"config",setup(){const n=g.currentRoute.value.query.id,d=g.currentRoute.value.query.namespace,r=a("data"),s=l({namespace_id:Number(n)}),u=a([]),c=()=>{var a;(a=s,e({url:"/config/getAllConfigs",method:"post",data:a})).then((e=>{u.value=e.data}))},i=l({namespace_id:Number(n),pageIndex:1,pageSize:10}),p=a([]),m=a(0),b=()=>{var a;(a=i,e({url:"/log/getAllLogs",method:"post",data:a})).then((e=>{p.value=e.data.log,m.value=e.data.count||50}))};c(),b();const y=a(!1);let k=l({key:"",value:""});return{namespace:d,namespaceID:n,message:r,dQuery:s,dTableData:u,lQuery:i,lTableData:p,lPageTotal:m,dHandleDelete:(e,a)=>{t.confirm("确定要删除吗？","提示",{type:"warning"}).then((()=>{f({namespace_id:Number(e),key:a.key.substring(d.length+1),value:a.value,type:1}).then((e=>{0===e.status?(o.success("添加成功"),b()):o.error("添加失败")}))})).catch((()=>{}))},dHandleAdd:()=>{k.key="",k.value="",y.value=!0},dHandlePageChange:e=>{s.pageIndex=e,c()},lHandlePageChange:e=>{i.pageIndex=e,b()},lHandleDelete:a=>{t.confirm("确定要删除吗？","提示",{type:"warning"}).then((()=>{var l;(l={id:a},e({url:"/log/delLog",method:"post",data:l})).then((e=>{0===e.status?(o.success("删除成功"),b()):o.error("删除失败")}))})).catch((()=>{}))},lHandleCommit:a=>{t.confirm("确定要提交吗？","提示",{type:"warning"}).then((()=>{var l;(l={id:a,namespace_id:Number(n)},e({url:"/log/commit",method:"post",data:l})).then((e=>{0===e.status?(o.success("提交成功"),b(),c()):o.error("提交失败")}))})).catch((()=>{}))},addConfig:()=>{t.confirm("确定要添加吗？","提示",{type:"warning"}).then((()=>{f({namespace_id:Number(n),key:k.key,value:k.value,type:0}).then((e=>{0===e.status?(o.success("添加成功"),y.value=!1,b()):o.error("添加失败")}))})).catch((()=>{}))},addVisible:y,form:k}}},y={class:""},k={class:"crumbs"},h=s("i",{class:"el-icon-lx-copy"},null,-1),v={class:"container"},_={class:"handle-box"},C=c("新增"),w=c("删除"),V={key:0},x={key:1},H={key:0},D={key:1},T=c("提交"),I=c("回滚"),z=c("删除"),A={class:"pagination"},N={class:"dialog-footer"},P=c("取 消"),U=c("确 定");b.render=function(e,a,l,t,o,g){const f=n("el-breadcrumb-item"),b=n("el-breadcrumb"),L=n("el-button"),Q=n("el-table-column"),j=n("el-table"),q=n("el-tab-pane"),S=n("el-tag"),R=n("el-pagination"),B=n("el-tabs"),F=n("el-input"),E=n("el-form-item"),G=n("el-form"),J=n("el-dialog");return d(),r("div",y,[s("div",k,[s(b,{separator:"/"},{default:u((()=>[s(f,null,{default:u((()=>[h,c(" 命名空间: "+i(t.namespace),1)])),_:1})])),_:1})]),s("div",v,[s(B,{modelValue:t.message,"onUpdate:modelValue":a[1]||(a[1]=e=>t.message=e)},{default:u((()=>[s(q,{label:"数据",name:"data"},{default:u((()=>[s("div",_,[s(L,{type:"primary",icon:"el-icon-plus",onClick:t.dHandleAdd},{default:u((()=>[C])),_:1},8,["onClick"])]),s(j,{data:t.dTableData,border:"",class:"table",ref:"multipleTable","header-cell-class-name":"table-header"},{default:u((()=>[s(Q,{prop:"key",label:"key"}),s(Q,{prop:"value",label:"value"}),s(Q,{label:"操作",align:"center"},{default:u((e=>[s(L,{type:"text",icon:"el-icon-delete",class:"red",onClick:a=>t.dHandleDelete(t.namespaceID,e.row)},{default:u((()=>[w])),_:2},1032,["onClick"])])),_:1})])),_:1},8,["data"])])),_:1}),s(q,{label:"操作记录",name:"operation"},{default:u((()=>["operation"===t.message?(d(),r(p,{key:0},[s(j,{data:t.lTableData,border:"",class:"table",ref:"multipleTable","header-cell-class-name":"table-header"},{default:u((()=>[s(Q,{prop:"id",label:"id"}),s(Q,{label:"操作类型",align:"center"},{default:u((e=>[s(S,{effect:"dark",type:0===e.row.type?"success":"danger"},{default:u((()=>[0===e.row.type?(d(),r("p",V," Set ")):(d(),r("p",x," Del "))])),_:2},1032,["type"])])),_:1}),s(Q,{prop:"key",label:"key"}),s(Q,{prop:"value",label:"value"}),s(Q,{prop:"username",label:"用户"}),s(Q,{label:"状态",align:"center"},{default:u((e=>[s(S,{effect:"dark",type:1===e.row.status?"success":"danger"},{default:u((()=>[1===e.row.status?(d(),r("p",H," Committed ")):(d(),r("p",D," Uncommitted "))])),_:2},1032,["type"])])),_:1}),s(Q,{label:"操作",align:"center"},{default:u((e=>[0===e.row.status?(d(),r(L,{key:0,type:"text",icon:"el-icon-s-promotion",onClick:a=>t.lHandleCommit(e.row.id)},{default:u((()=>[T])),_:2},1032,["onClick"])):m("",!0),1===e.row.status?(d(),r(L,{key:1,type:"text",icon:"el-icon-s-promotion",class:"green",onClick:a=>t.lHandleCommit(e.row.id)},{default:u((()=>[I])),_:2},1032,["onClick"])):m("",!0),s(L,{type:"text",icon:"el-icon-delete",class:"red",onClick:a=>t.lHandleDelete(e.row.id)},{default:u((()=>[z])),_:2},1032,["onClick"])])),_:1})])),_:1},8,["data"]),s("div",A,[s(R,{background:"",layout:"total, prev, pager, next","current-page":t.lQuery.pageIndex,"page-size":t.lQuery.pageSize,total:t.lPageTotal,onCurrentChange:t.lHandlePageChange},null,8,["current-page","page-size","total","onCurrentChange"])])],64)):m("",!0)])),_:1})])),_:1},8,["modelValue"])]),s(J,{title:"新增",modelValue:t.addVisible,"onUpdate:modelValue":a[5]||(a[5]=e=>t.addVisible=e),width:"30%"},{footer:u((()=>[s("span",N,[s(L,{onClick:a[4]||(a[4]=e=>t.addVisible=!1)},{default:u((()=>[P])),_:1}),s(L,{type:"primary",onClick:t.addConfig},{default:u((()=>[U])),_:1},8,["onClick"])])])),default:u((()=>[s(G,{"label-width":"70px"},{default:u((()=>[s(E,{label:"key"},{default:u((()=>[s(F,{modelValue:t.form.key,"onUpdate:modelValue":a[2]||(a[2]=e=>t.form.key=e)},null,8,["modelValue"])])),_:1}),s(E,{label:"value"},{default:u((()=>[s(F,{modelValue:t.form.value,"onUpdate:modelValue":a[3]||(a[3]=e=>t.form.value=e)},null,8,["modelValue"])])),_:1})])),_:1})])),_:1},8,["modelValue"])])};export default b;
